name = "tft-trading-system-enhanced"
main = "src/index-enhanced.js"
compatibility_date = "2025-01-10"
compatibility_flags = ["nodejs_compat"]

# Production environment configuration
[env.production]
name = "tft-trading-system"
main = "src/index-enhanced.js"

# Production KV bindings - MUST use real UUID from main wrangler.toml
[[env.production.kv_namespaces]]
binding = "TRADING_RESULTS"
id = "321593c6717448dfb24ea2bd48cde1fa"

# Production R2 bindings
[[env.production.r2_buckets]]
binding = "TFT_TRADING_MODELS"
bucket_name = "tft-trading-models"

# Production AI binding
[env.production.ai]
binding = "AI"

# Production Durable Objects
[[env.production.durable_objects.bindings]]
name = "CACHE_DO"
class_name = "CacheDurableObject"

[[env.production.durable_objects.bindings]]
name = "PORTFOLIO_DO"
class_name = "PortfolioDO"

# Production variables
[env.production.vars]
ENVIRONMENT = "production"
WORKER_VERSION = "2.0-enhanced"
LOG_LEVEL = "info"
ENABLE_CACHE = "true"
ENABLE_MIGRATION = "true"
NEW_API_PERCENTAGE = "10"

# Staging environment configuration
[env.staging]
name = "tft-trading-system-staging"
main = "src/index-enhanced.js"

# Staging KV bindings - uses preview_id from main wrangler.toml
[[env.staging.kv_namespaces]]
binding = "TRADING_RESULTS"
id = "220ca67255ed4bfeada7eb6816ce6413"

# Staging R2 bindings
[[env.staging.r2_buckets]]
binding = "TFT_TRADING_MODELS"
bucket_name = "tft-trading-models"

# Staging AI binding
[env.staging.ai]
binding = "AI"

# Staging Durable Objects
[[env.staging.durable_objects.bindings]]
name = "CACHE_DO"
class_name = "CacheDurableObject"

[[env.staging.durable_objects.bindings]]
name = "PORTFOLIO_DO"
class_name = "PortfolioDO"

# Staging variables
[env.staging.vars]
ENVIRONMENT = "staging"
WORKER_VERSION = "2.0-enhanced-staging"
LOG_LEVEL = "debug"
ENABLE_CACHE = "true"
ENABLE_MIGRATION = "true"
NEW_API_PERCENTAGE = "100"

# Durable Objects migrations
[[migrations]]
tag = "v1"
new_sqlite_classes = ["CacheDurableObject"]

[[migrations]]
tag = "v3"
new_sqlite_classes = ["PortfolioDO"]
