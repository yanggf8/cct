# Wrangler configuration for TFT Trading System Worker (GPT-OSS-120B Sentiment)

name = "tft-trading-system"
main = "src/index.js"
compatibility_date = "2024-01-01"
account_id = "ed01ccea0b8ee7138058c4378cc83e54"

# Allow nodejs_compat for TensorFlow.js compatibility
compatibility_flags = ["nodejs_compat"]

# Build configuration - TensorFlow.js handled automatically by modern Wrangler

# Production cron schedule - all times in UTC for proper EST/EDT conversion
[triggers]
crons = [
  "30 12 * * 1-5",  # 8:30 AM EST/EDT - Morning predictions + high-confidence alerts
  "0 16 * * 1-5",   # 12:00 PM EST/EDT - Midday validation + afternoon forecasts
  "5 20 * * 1-5",   # 4:05 PM EST/EDT - Daily validation + next-day predictions
  "0 20 * * FRI",   # 4:00 PM EST/EDT Friday - Weekly market close report
  "0 14 * * SUN"    # 10:00 AM EST/EDT Sunday - Weekly accuracy report
]

# KV namespace for storing analysis results
[[kv_namespaces]]
binding = "TRADING_RESULTS"
id = "321593c6717448dfb24ea2bd48cde1fa"
preview_id = "220ca67255ed4bfeada7eb6816ce6413"

# AI binding for GPT-OSS-120B sentiment analysis and DistilBERT fallback
[ai]
binding = "AI"

# R2 bucket for trained model files
[[r2_buckets]]
bucket_name = "tft-trading-models"
binding = "TRAINED_MODELS"

# R2 bucket for enhanced model files
[[r2_buckets]]
bucket_name = "enhanced-trading-models"
binding = "ENHANCED_MODELS"

# Environment variables
[vars]
EMAIL_ENABLED = "false"
WORKER_VERSION = "1.0"
TIMEZONE = "America/New_York"
# Trading symbols configuration
TRADING_SYMBOLS = "AAPL,MSFT,GOOGL,TSLA,NVDA"
# Logging configuration (error, warn, info, debug)
LOG_LEVEL = "info"
# AI model configuration
GPT_MAX_TOKENS = "2000"
GPT_TEMPERATURE = "0.1"
# Analysis configuration
MIN_NEWS_ARTICLES = "5"
MAX_NEWS_ARTICLES = "20"
CONFIDENCE_THRESHOLD = "0.6"
# KV storage TTL (in seconds)
KV_ANALYSIS_TTL = "604800"  # 7 days
KV_GRANULAR_TTL = "7776000" # 90 days

# Secrets to be set via: wrangler secret put SECRET_NAME
# Core secrets:
# - WORKER_API_KEY: API key for protecting sensitive endpoints (REQUIRED)
# - FACEBOOK_PAGE_TOKEN: Facebook Messenger bot token
# - FACEBOOK_RECIPIENT_ID: Your Facebook user ID
#
# Free News API keys:
# - FMP_API_KEY: Financial Modeling Prep free API key (financialmodelingprep.com)
# - NEWSAPI_KEY: NewsAPI.org free development key (newsapi.org)
#
# Optional secrets:
# - SLACK_WEBHOOK_URL: Slack webhook for alerts
# - ALERT_EMAIL: Email address for trading alerts
# - LINE_CHANNEL_TOKEN: LINE messaging API token
# - LINE_USER_ID: Your LINE user ID
#
# Example deployment commands:
# wrangler secret put WORKER_API_KEY
# wrangler secret put FMP_API_KEY
# wrangler secret put NEWSAPI_KEY